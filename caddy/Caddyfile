{
    email {$ACME_EMAIL}
}

# Explicitly listen on port 80 and 443 to stop the loop
http://sky0cloud.dpdns.org, https://sky0cloud.dpdns.org {
    
    # Cloudflare optimization
    encode zstd gzip

    # Matrix Well-Known
    handle /.well-known/matrix/* {
        root * /srv/well-known
        file_server
        header Access-Control-Allow-Origin "*"
        header Content-Type application/json
    }

    # API Traffic to Tuwunel
    @matrix {
        path /_matrix/*
        path /_synapse/admin/*
    }
    handle @matrix {
        reverse_proxy sky0cloud-tuwunel:6167
    }

    # Everything else to Element
    handle {
        reverse_proxy sky0cloud-element:80
    }
}
