services:
  caddy:
    image: caddy:2.8-alpine
    container_name: sky0cloud-caddy
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    environment:
<<<<<<< ours
      - DOMAIN=sky0cloud.dpdns.org
      - ACME_EMAIL=admin@sky0cloud.dpdns.org
=======
      - DOMAIN=${DOMAIN:-sky0cloud.dpdns.org}
      - ACME_EMAIL=${ACME_EMAIL:-admin@sky0cloud.dpdns.org}
>>>>>>> theirs
    volumes:
      - ./caddy/Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
      - ./well-known:/srv/well-known:ro
    depends_on:
      - tuwunel
      - element-web

  tuwunel:
<<<<<<< ours
    # Using the official GHCR image as per documentation
    image: ghcr.io/matrix-construct/tuwunel:latest
    container_name: sky0cloud-tuwunel
    restart: unless-stopped
    environment:
      # Backward compatibility allows us to keep your current config name
      TUWUNEL_CONFIG: /etc/tuwunel.toml
    volumes:
      - ./conduwuit/conduwuit.toml:/etc/tuwunel.toml:ro
      - conduwuit_data:/var/lib/tuwunel
=======
    image: ${TUWUNEL_IMAGE:-ghcr.io/tuwunel/tuwunel:latest}
    container_name: sky0cloud-tuwunel
    restart: unless-stopped
    environment:
      TUWUNEL_CONFIG: /etc/tuwunel/conduwuit.toml
    volumes:
      - ./conduwuit/conduwuit.toml:/etc/tuwunel/conduwuit.toml:ro
      - conduwuit_data:/var/lib/conduwuit
>>>>>>> theirs
    expose:
      - "6167"

  element-web:
    image: vectorim/element-web:latest
    container_name: sky0cloud-element
    restart: unless-stopped
    volumes:
      - ./element/config.json:/app/config.json:ro
      - ./element/sky0cloud-theme.css:/app/sky0cloud-theme.css:ro
<<<<<<< ours
=======
      - ./element/welcome.html:/app/welcome.html:ro
      - ./element/icon.png:/app/icon.png:ro
>>>>>>> theirs
    expose:
      - "80"

volumes:
  caddy_data:
  caddy_config:
  conduwuit_data:
