services:
  caddy:
    image: caddy:2.8-alpine
    container_name: sky0cloud-caddy
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    environment:
      - DOMAIN=sky0cloud.dpdns.org
      - ACME_EMAIL=admin@sky0cloud.dpdns.org
    volumes:
      - ./caddy/Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
      - ./well-known:/srv/well-known:ro
    depends_on:
      - tuwunel
      - element-web

  tuwunel:
    image: ghcr.io/the-ashen-one/tuwunel:latest
    container_name: sky0cloud-tuwunel
    restart: unless-stopped
    environment:
      TUWUNEL_CONFIG: /etc/tuwunel/conduwuit.toml
    volumes:
      - ./conduwuit/conduwuit.toml:/etc/tuwunel/conduwuit.toml:ro
      - conduwuit_data:/var/lib/conduwuit
    expose:
      - "6167"

  element-web:
    image: vectorim/element-web:latest
    container_name: sky0cloud-element
    restart: unless-stopped
    volumes:
      - ./element/config.json:/app/config.json:ro
      - ./element/sky0cloud-theme.css:/app/sky0cloud-theme.css:ro
      - ./element/welcome.html:/app/welcome.html:ro
      - ./element/icon.png:/app/icon.png:ro
    expose:
      - "80"

volumes:
  caddy_data:
  caddy_config:
  conduwuit_data:
